<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create an sghmc object — sghmcSetup • sgmcmc</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sgmcmc</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/sgmcmc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gaussMixture.html">Worked Example: Simulate from a Gaussian Mixture</a>
    </li>
    <li>
      <a href="../articles/logisticRegression.html">Worked Example: Logistic Regression</a>
    </li>
    <li>
      <a href="../articles/mvGauss.html">Worked Example: Simulate from a Multivariate Gaussian</a>
    </li>
    <li>
      <a href="../articles/nn.html">Advanced Example: Simulate from a Bayesian Neural Network -- Storage Constraints</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/STOR-i/sgmcmc">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create an sghmc object</h1>
    </div>

    
    <p>Creates an sghmc (stochastic gradient Hamiltonian Monte Carlo) object which can be passed to 
 <code><a href='sgmcmcStep.html'>sgmcmcStep</a></code> to simulate from 1 step of SGLD for the posterior defined by logLik
 and logPrior. This allows the user to code the loop themselves, as in many standard 
 TensorFlow procedures (such as optimization). Which means they do not need to store 
 the chain at each iteration. This is useful when the full chain needs a lot of memory.</p>
    

    <pre class="usage"><span class='fu'>sghmcSetup</span>(<span class='no'>logLik</span>, <span class='no'>dataset</span>, <span class='no'>params</span>, <span class='no'>stepsize</span>, <span class='kw'>logPrior</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>minibatchSize</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>L</span> <span class='kw'>=</span> <span class='fl'>5L</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>logLik</th>
      <td><p>function which takes parameters and dataset 
(list of TensorFlow variables and placeholders respectively) as input. 
It should return a TensorFlow expression which defines the log likelihood of the model.</p></td>
    </tr>
    <tr>
      <th>dataset</th>
      <td><p>list of numeric R arrays which defines the datasets for the problem.
The names in the list should correspond to those referred to in the logLik and logPrior functions</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>list of numeric R arrays which define the starting point of each parameter.
The names in the list should correspond to those referred to in the logLik and logPrior functions</p></td>
    </tr>
    <tr>
      <th>stepsize</th>
      <td><p>list of numeric values corresponding to the SGLD stepsizes for each parameter
The names in the list should correspond to those in params.
Alternatively specify a single numeric value to use that stepsize for all parameters.</p></td>
    </tr>
    <tr>
      <th>logPrior</th>
      <td><p>optional. Default uninformative improper prior.
Function which takes parameters (list of TensorFlow variables) as input.
The function should return a TensorFlow tensor which defines the log prior of the model.</p></td>
    </tr>
    <tr>
      <th>minibatchSize</th>
      <td><p>optional. Default 0.01.
Numeric or integer value that specifies amount of dataset to use at each iteration 
either as proportion of dataset size (if between 0 and 1) or actual magnitude (if an integer).</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>optional. Default 0.01. 
List of numeric values corresponding to the SGHMC momentum tuning constants
(\(\alpha\) in the original paper). One value should be given 
for each parameter in params, the names should correspond to those in params.
Alternatively specify a single float to specify that value for all parameters.</p></td>
    </tr>
    <tr>
      <th>L</th>
      <td><p>optional. Default 5L. Integer specifying the trajectory parameter of the simulation, 
as defined in the main reference.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The function returns an 'sghmc' object, which is used to pass the required information
 about the current model to the <code><a href='sgmcmcStep.html'>sgmcmcStep</a></code> function. The function 
 <code><a href='sgmcmcStep.html'>sgmcmcStep</a></code> runs one step of sghmc. The sghmc object has the following attributes:</p><dl class='dl-horizontal'>
<dt>params</dt><dd><p>list of tf$Variables with the same names as the params list passed to
 <code>sghmcSetup</code>. This is the object passed to the logLik and logPrior functions you
 declared to calculate the log posterior gradient estimate.</p></dd>
<dt>estLogPost</dt><dd><p>a tensor that estimates the log posterior given the current 
 placeholders and params.</p></dd>
<dt>N</dt><dd><p>dataset size.</p></dd>
<dt>data</dt><dd><p>dataset as passed to <code>sghmcSetup</code>.</p></dd>
<dt>n</dt><dd><p>minibatchSize as passed to <code>sghmcSetup</code>.</p></dd>
<dt>placeholders</dt><dd><p>list of tf$placeholder objects with the same names as dataset
 used to feed minibatches of data to <code><a href='sgmcmcStep.html'>sgmcmcStep</a></code>. These are also the objects
 that gets fed to the dataset argument of the logLik and logPrior functions you declared.</p></dd>
<dt>stepsize</dt><dd><p>list of stepsizes as passed to <code>sghmcSetup</code>.</p></dd>
<dt>alpha</dt><dd><p>list of alpha tuning parameters as passed to <code>sghmcSetup</code>.</p></dd>
<dt>L</dt><dd><p>integer trajectory parameter as passed to <code>sghmcSetup</code>.</p></dd>
<dt>dynamics</dt><dd><p>a list of TensorFlow steps that are evaluated by <code><a href='sgmcmcStep.html'>sgmcmcStep</a></code>.</p></dd></dl>

    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># Simulate from a Normal Distribution, unknown location and known scale with uninformative prior</span>
<span class='co'># Run sgmcmc step by step and calculate estimate of location on the fly to reduce storage</span>
<span class='no'>dataset</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='st'>"x"</span> <span class='kw'>=</span> <span class='fu'>rnorm</span>(<span class='fl'>1000</span>))
<span class='no'>params</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='st'>"theta"</span> <span class='kw'>=</span> <span class='fl'>0</span>)
<span class='no'>logLik</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>params</span>, <span class='no'>dataset</span>) {
    <span class='no'>distn</span> <span class='kw'>=</span> <span class='no'>tf</span>$<span class='no'>contrib</span>$<span class='no'>distributions</span>$<span class='fu'>Normal</span>(<span class='no'>params</span>$<span class='no'>theta</span>, <span class='fl'>1</span>)
    <span class='fu'>return</span>(<span class='no'>tf</span>$<span class='fu'>reduce_sum</span>(<span class='no'>distn</span>$<span class='fu'>log_prob</span>(<span class='no'>dataset</span>$<span class='no'>x</span>)))
}
<span class='no'>stepsize</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='st'>"theta"</span> <span class='kw'>=</span> <span class='fl'>1e-4</span>)
<span class='no'>sghmc</span> <span class='kw'>=</span> <span class='fu'>sghmcSetup</span>(<span class='no'>logLik</span>, <span class='no'>dataset</span>, <span class='no'>params</span>, <span class='no'>stepsize</span>)
<span class='no'>nIters</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>4L</span>
<span class='co'># Initialize location estimate</span>
<span class='no'>locEstimate</span> <span class='kw'>=</span> <span class='fl'>0</span>
<span class='co'># Initialise TensorFlow session</span>
<span class='no'>sess</span> <span class='kw'>=</span> <span class='fu'><a href='initSess.html'>initSess</a></span>(<span class='no'>sghmc</span>)
<span class='kw'>for</span> ( <span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='no'>nIters</span> ) {
    <span class='fu'><a href='sgmcmcStep.html'>sgmcmcStep</a></span>(<span class='no'>sghmc</span>, <span class='no'>sess</span>)
    <span class='no'>locEstimate</span> <span class='kw'>=</span> <span class='no'>locEstimate</span> + <span class='fl'>1</span> / <span class='no'>nIters</span> * <span class='fu'><a href='getParams.html'>getParams</a></span>(<span class='no'>sghmc</span>, <span class='no'>sess</span>)$<span class='no'>theta</span>
}
<span class='co'># For more examples see vignettes</span>
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://lancs.ac.uk/~bakerj1/'>Jack Baker</a>, <a href='http://www.lancs.ac.uk/~nemeth/'>Christopher Nemeth</a>, <a href='http://www.maths.lancs.ac.uk/~fearnhea/'>Paul Fearnhead</a>, <a href='https://homes.cs.washington.edu/~ebfox/'>Emily B. Fox</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
